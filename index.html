
	                      circle: false,
	                                  circlemarker: false,
	                      marker: true                                    
	                  },
	                  edit: false,
	                  remove: false
	              }
	          };         
	          
	          var cartoData = null; //These adds data from Carto using the SQL API, declares variables, and writes the SQL selection query
	          var sqlQuery = "SELECT the_geom, address, name, doctor, contactnum, email, fee, website, hours, notes FROM " + config.cartoTablename;
	          var map = L.map('map', { center: config.mapcenter, zoom: 5});   // Creates the Leaflet map object
	          map.addControl(new L.Control.Fullscreen());
		
				  
	          var Mapbox = L.tileLayer('https://api.mapbox.com/styles/v1/anditabinas/ck03r85tj4p951cl5s673xu47/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiYW5kaXRhYmluYXMiLCJhIjoiY2plejI3aHp3MDV3MjMzcW9ydXl2bHNmZiJ9.9h6j7BbkM-PUtK0zaZ1iUg', {
	              attribution: '&copy; <a href="mapbox://styles/anditabinas/ck03r85tj4p951cl5s673xu47">Mapbox<\/a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap<\/a> contributors',
	              subdomains: 'abcd',
	              maxZoom: 20 //Adds the tilelayer basemap; I used my mapbox style here.
	          }); 
	          Mapbox.addTo(map);
	          
	          var osmGeocoder = new L.Control.OSMGeocoder({position: 'topleft'}); //Adds Search toolbar; OSMGeocoder       
	          map.addControl(osmGeocoder);
	          
	          var lc = L.control.locate({  //Adds Locate Control; to locate the user's location on the map
	                  position: 'topleft',
	              icon: 'fa fa-hand-o-down'
	          });     
	          map.addControl(lc);
			 
	          var getData = "https://" + config.cartoUsername + ".carto.com/api/v2/sql?format=GeoJSON&q=" + sqlQuery; //Fetches data input on the carto database
	          function getGeoJSON() {
	              $.getJSON(getData, function (data) {
	                  cartoData = L.geoJson(data, {
	                      onEachFeature: function (feature, layer) {
	                          layer.bindPopup('<b>Name: <\/b>' + feature.properties.name + '<br>' + '<b>Doctor: <\/b>' + feature.properties.doctor + '<br>' + '<b>Address: <\/b>' + feature.properties.address + '<br>' + '<b>Contact Number: <\/b>' + feature.properties.contactnum + '<br>' + '<b>Email Address: <\/b>' + feature.properties.email + '<br>' + '<b>Fees (Initial/Succeeding): <\/b>' + feature.properties.fee + '<br>' + '<b>Website: <\/b>' + feature.properties.website + '<br>' + '<b>Opening Hours: <\/b>' + feature.properties.hours + '<br>' + '<b>Notes/Recommendations: <\/b>' + feature.properties.notes + '');
	                      }           
	                  }).addTo(map);
	              });
	          }
	          getGeoJSON();
	          var drawnItems = new L.FeatureGroup();
	          var drawControl = new L.Control.Draw(config.drawOptions);
	          var controlOnMap = false;
	          function startEdits() {
	              if (controlOnMap === true) {
	                  map.removeControl(drawControl);
	                  controlOnMap = false;
	              }
	              map.addControl(drawControl);
	              controlOnMap = true;
	          }
	          function stopEdits() {
	              map.removeControl(drawControl);
	              controlOnMap = false;
	          }
	          map.on(L.Draw.Event.CREATED, function (e) {
	              var layer = e.layer;
	              map.addLayer(drawnItems);
	              drawnItems.addLayer(layer);		  
	              dialog.dialog("open");	      		  			  
	          });
	          					
		
	          var dialog = $("#dialog").dialog({
	              autoOpen: false,
	              height: 500,
	              width: 360,
	              modal: true,
	              position: {
	                  my: "center center",
	                  at: "center center",
	                  of: "#map"
	              },
	              buttons: {
	                  "Add to Database": setData,
	                  Cancel: function () {
	                      dialog.dialog("close");
	                      refreshLayer();             
	                  }
	              },
	              close: function () {
	                  form[0].reset();
	                  refreshLayer();
	                  console.log("Dialog closed");
	              }
	          });
	          
	          form = dialog.find("form").on("submit", function (event) {
	              event.preventDefault();
	              setData();
	          });
	          function setData() {
	              var enteredFname = "'" + fname.value + "'",
	                  enteredAddress = "'" + address.value + "'",
	                  enteredDoctor = "'" + doctor.value + "'",
	                  enteredContactnum = "'" + contactnum.value + "'",
	                  enteredEmail = "'" + email.value + "'",			  
	                  enteredFee = "'" + fee.value + "'",
	                  enteredWebsite = "'" + website.value + "'",
	                  enteredHours = "'" + hours.value + "'",
	                  enteredNotes = "'" + notes.value + "'";             
	              drawnItems.eachLayer(function (layer) {
	                  var drawing = "'" + JSON.stringify(layer.toGeoJSON().geometry) + "'",   //Converts the drawing to a GeoJSON
	                      sql = "SELECT " + config.cartoInsertFunction + "("; //Constructs the SQL Query from the entered parameters on the dialog/form
	                  sql += drawing;
	                  sql += "," + enteredAddress;
	                  sql += "," + enteredFname;
	                  sql += "," + enteredDoctor;
	                  sql += "," + enteredContactnum;
	                  sql += "," + enteredEmail;			      
	                  sql += "," + enteredFee;
	                  sql += "," + enteredWebsite;
	                  sql += "," + enteredHours;
	                  sql += "," + enteredNotes;              
	                  sql += ");";
	                  console.log(drawing);
	                  
	                  $.ajax({
	                      type: 'POST',
	                      url: 'https://' + config.cartoUsername + '.carto.com/api/v2/sql', //Sending the data to Carto
	                      crossDomain: true,
	                      data: {"q": sql},
	                      dataType: 'json',
	                      success: function (responseData, textStatus, jqXHR) {
	                          console.log("Data saved");
	                      },
	                      error: function (responseData, textStatus, errorThrown) {
	                          console.log("Problem saving the data");
	                      }
	                  });
	                  var newData = layer.toGeoJSON();
	                    newData.properties.address = address.value;
	                    newData.properties.name = fname.value;
	                    newData.properties.doctor = doctor.value;
	                    newData.properties.contactnum = contactnum.value;
	                    newData.properties.email = email.value;			      
	                    newData.properties.fee = fee.value;
	                    newData.properties.website = website.value;
	                    newData.properties.hours = hours.value;
	                    newData.properties.notes = notes.value;                   
	                  cartoData.addData(newData);
	              });
	              
	              dialog.dialog("close");
	          }
	          function refreshLayer() {
	              console.log("drawnItems has been cleared");
	              map.removeLayer(drawnItems);
	              drawnItems = new L.FeatureGroup();
	          }
	          
	          
	          
	          
	</script>
</body>
</html>
